# ComfyUI å½±ç‰‡ç”Ÿæˆå™¨

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11-blue.svg)
![Flask](https://img.shields.io/badge/Flask-2.3.3-green.svg)
![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

ä¸€å€‹åŸºæ–¼ Docker çš„ ComfyUI å½±ç‰‡ç”Ÿæˆ API ç³»çµ±ï¼Œæä¾›å®Œæ•´çš„ç¶²é ä»‹é¢ä¾†ç”Ÿæˆå’Œç®¡ç†å½±ç‰‡ã€‚

[åŠŸèƒ½ç‰¹è‰²](#åŠŸèƒ½ç‰¹è‰²) â€¢ [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹) â€¢ [ä½¿ç”¨æ•™ç¨‹](#ä½¿ç”¨æ•™ç¨‹) â€¢ [APIæ–‡æª”](#apiæ–‡æª”) â€¢ [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

</div>

## ğŸ¬ åŠŸèƒ½ç‰¹è‰²

### é›™æ¨¡å¼å½±ç‰‡ç”Ÿæˆ
- **å–®åœ–æ¨¡å¼**ï¼šä¸Šå‚³ä¸€å¼µåœ–ç‰‡ + æç¤ºè©ç”Ÿæˆå½±ç‰‡
- **é¦–å°¾å¹€æ¨¡å¼**ï¼šä¸Šå‚³å…©å¼µåœ–ç‰‡ï¼ˆé¦–å¹€+å°¾å¹€ï¼‰+ æç¤ºè©ç”Ÿæˆå½±ç‰‡

### å®Œæ•´çš„ Web ç•Œé¢
- ğŸ¨ **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šæ”¯æ´æ¡Œé¢å’Œè¡Œå‹•è£ç½®
- ğŸ“¤ **æ‹–æ‹½ä¸Šå‚³**ï¼šç›´è¦ºçš„åœ–ç‰‡ä¸Šå‚³é«”é©—
- âš¡ **å³æ™‚ç›£æ§**ï¼šWebSocket å³æ™‚ç‹€æ…‹æ›´æ–°
- ğŸ“Š **æ’éšŠç®¡ç†**ï¼šå¤šä»»å‹™æ’éšŠå’Œé€²åº¦è¿½è¹¤
- ğŸ“š **æ­·å²è¨˜éŒ„**ï¼šå®Œæ•´çš„ç”Ÿæˆæ­·å²å’Œæœå°‹åŠŸèƒ½
- ğŸ¥ **å½±ç‰‡æ’­æ”¾**ï¼šå…§å»ºå½±ç‰‡æ’­æ”¾å™¨å’Œä¸‹è¼‰åŠŸèƒ½
- ğŸ–¼ï¸ **ç¸®åœ–é è¦½**ï¼šè‡ªå‹•ç”Ÿæˆå½±ç‰‡ç¸®åœ–

### æŠ€è¡“ç‰¹è‰²
- ğŸ³ **Docker å®¹å™¨åŒ–**ï¼šä¸€éµéƒ¨ç½²ï¼Œç’°å¢ƒéš”é›¢
- ğŸ”„ **è‡ªå‹•ä»»å‹™è™•ç†**ï¼šæ™ºèƒ½æ’éšŠå’ŒéŒ¯èª¤æ¢å¾©
- ğŸ’¾ **SQLite æ•¸æ“šåº«**ï¼šè¼•é‡ç´šæ•¸æ“šå­˜å„²
- ğŸ”Œ **ComfyUI æ•´åˆ**ï¼šç„¡ç¸«å°æ¥ç¾æœ‰ ComfyUI ç³»çµ±

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®è¦æ±‚

- Docker å’Œ Docker Compose
- é‹è¡Œä¸­çš„ ComfyUI æœå‹™ï¼ˆé è¨­åœ¨ 8188 åŸ ï¼‰
- è‡³å°‘ 12GB å¯ç”¨è¨˜æ†¶é«”

### ä¸€éµéƒ¨ç½²

1. **å…‹éš†å°ˆæ¡ˆ**
```bash
git clone https://github.com/CreateIntelligens/wan2.2_image2video.git
cd wan2.2_image2video
```

2. **é…ç½®ç’°å¢ƒ**
```bash
# ç·¨è¼¯ .env æ–‡ä»¶ï¼Œè¨­å®š ComfyUI è·¯å¾‘
echo "COMFYUI_PATH=/path/to/your/ComfyUI" > .env
```

3. **å•Ÿå‹•æœå‹™**
```bash
docker-compose up -d
```

4. **è¨ªå•ç³»çµ±**
```
http://localhost:5005
```

å°±æ˜¯é€™éº¼ç°¡å–®ï¼ğŸ‰

## ğŸ“– ä½¿ç”¨æ•™ç¨‹

### å–®åœ–æ¨¡å¼

1. åœ¨ä¸»é é¸æ“‡ã€Œå–®åœ–ç”Ÿæˆã€æ¨¡å¼
2. è¼¸å…¥è©³ç´°çš„æç¤ºè©æè¿°
3. ä¸Šå‚³ä¸€å¼µåœ–ç‰‡ï¼ˆæ”¯æ´ JPG/PNG/GIFï¼‰
4. é¸æ“‡å½±ç‰‡å°ºå¯¸ï¼š
   - `480 x 832`ï¼ˆç›´å‘ï¼‰
   - `832 x 480`ï¼ˆæ©«å‘ï¼‰
5. é¸æ“‡å½±ç‰‡æ™‚é•·ï¼š
   - `5ç§’`ï¼ˆç´„4åˆ†é˜è™•ç†æ™‚é–“ï¼‰
   - `8ç§’`ï¼ˆç´„7åˆ†é˜è™•ç†æ™‚é–“ï¼‰
6. é»æ“Šã€Œé–‹å§‹ç”Ÿæˆå½±ç‰‡ã€

### é¦–å°¾å¹€æ¨¡å¼

1. åœ¨ä¸»é é¸æ“‡ã€Œé¦–å°¾å¹€ç”Ÿæˆã€æ¨¡å¼
2. è¼¸å…¥è©³ç´°çš„æç¤ºè©æè¿°
3. åˆ†åˆ¥ä¸Šå‚³é¦–å¹€å’Œå°¾å¹€åœ–ç‰‡
4. é¸æ“‡ç›¸åŒçš„å°ºå¯¸å’Œæ™‚é•·è¨­å®š
5. é»æ“Šã€Œé–‹å§‹ç”Ÿæˆå½±ç‰‡ã€

### ä»»å‹™ç®¡ç†

- **å³æ™‚ç›£æ§**ï¼šåœ¨æ’éšŠç‹€æ…‹é é¢æŸ¥çœ‹è™•ç†é€²åº¦
- **æ­·å²è¨˜éŒ„**ï¼šåœ¨æ­·å²è¨˜éŒ„é é¢ç€è¦½æ‰€æœ‰ä»»å‹™
- **ä»»å‹™è©³æƒ…**ï¼šé»æ“Šä»»å‹™æŸ¥çœ‹è©³ç´°è³‡è¨Šå’Œä¸‹è¼‰å½±ç‰‡
- **æœå°‹åŠŸèƒ½**ï¼šæ ¹æ“šæç¤ºè©æˆ–æª”æ¡ˆåæœå°‹æ­·å²ä»»å‹™

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Browser   â”‚    â”‚   Flask App     â”‚    â”‚    ComfyUI     â”‚
â”‚                 â”‚â—„â”€â”€â–ºâ”‚                 â”‚â—„â”€â”€â–ºâ”‚                 â”‚
â”‚  - éŸ¿æ‡‰å¼ç•Œé¢    â”‚    â”‚  - API æœå‹™     â”‚    â”‚  - å½±ç‰‡ç”Ÿæˆ     â”‚
â”‚  - WebSocket    â”‚    â”‚  - ä»»å‹™ç®¡ç†     â”‚    â”‚  - å·¥ä½œæµè™•ç†   â”‚
â”‚  - æª”æ¡ˆä¸Šå‚³     â”‚    â”‚  - æ•¸æ“šåº«æ“ä½œ   â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   SQLite DB     â”‚
                       â”‚                 â”‚
                       â”‚  - ä»»å‹™è¨˜éŒ„     â”‚
                       â”‚  - ç‹€æ…‹è¿½è¹¤     â”‚
                       â”‚  - æ­·å²æ•¸æ“š     â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“æ£§

- **å¾Œç«¯**ï¼šFlask + Flask-SocketIO
- **å‰ç«¯**ï¼šåŸç”Ÿ JavaScript + CSS
- **æ•¸æ“šåº«**ï¼šSQLite
- **å®¹å™¨åŒ–**ï¼šDocker + Docker Compose
- **åœ–åƒè™•ç†**ï¼šOpenCV + Pillow
- **ComfyUI æ•´åˆ**ï¼šREST API

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
wan2.2_image2video/
â”œâ”€â”€ docker-compose.yaml              # Docker ç·¨æ’é…ç½®
â”œâ”€â”€ .env                            # ç’°å¢ƒè®Šæ•¸é…ç½®
â”œâ”€â”€ .gitignore                      # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                       # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ wan2.2_i2v_14b_single.json     # å–®åœ–å·¥ä½œæµæ¨¡æ¿
â”œâ”€â”€ wan2_2_i2v_14b_first_last.json # é¦–å°¾å¹€å·¥ä½œæµæ¨¡æ¿
â”œâ”€â”€ api/                            # ä¸»æ‡‰ç”¨ç›®éŒ„
â”‚   â”œâ”€â”€ app.py                      # Flask ä¸»æ‡‰ç”¨
â”‚   â”œâ”€â”€ database.py                 # æ•¸æ“šåº«æ“ä½œæ¨¡çµ„
â”‚   â”œâ”€â”€ Dockerfile                  # å®¹å™¨æ§‹å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt            # Python ä¾è³´æ¸…å–®
â”‚   â”œâ”€â”€ templates/                  # HTML æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ index.html             # ä¸»é é¢
â”‚   â”‚   â”œâ”€â”€ history.html           # æ­·å²è¨˜éŒ„é é¢
â”‚   â”‚   â”œâ”€â”€ detail.html            # ä»»å‹™è©³æƒ…é é¢
â”‚   â”‚   â””â”€â”€ queue.html             # æ’éšŠç‹€æ…‹é é¢
â”‚   â””â”€â”€ static/                     # éœæ…‹è³‡æº
â”‚       â”œâ”€â”€ css/app.css            # ä¸»è¦æ¨£å¼
â”‚       â”œâ”€â”€ js/app.js              # JavaScript åŠŸèƒ½
â”‚       â””â”€â”€ favicon.ico            # ç¶²ç«™åœ–æ¨™
â”œâ”€â”€ input/                          # ç”¨æˆ¶ä¸Šå‚³åœ–ç‰‡ç›®éŒ„
â”œâ”€â”€ output/                         # ç”Ÿæˆå½±ç‰‡è¼¸å‡ºç›®éŒ„
â”œâ”€â”€ thumbnails/                     # å½±ç‰‡ç¸®åœ–ç›®éŒ„
â””â”€â”€ database/                       # SQLite æ•¸æ“šåº«æ–‡ä»¶ç›®éŒ„
```

## âš™ï¸ é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹è®Šæ•¸ï¼š

```bash
# ComfyUI å®‰è£è·¯å¾‘
COMFYUI_PATH=/path/to/your/ComfyUI
```

### Docker Compose é…ç½®

ä¸»è¦é…ç½®é …ç›®ï¼š

- **åŸ è™Ÿå°æ‡‰**ï¼š`5005:5005`ï¼ˆå¯ä¿®æ”¹å·¦å´åŸ è™Ÿï¼‰
- **ComfyUI é€£æ¥**ï¼š`host.docker.internal:8188`
- **è³‡æ–™æŒä¹…åŒ–**ï¼šæ‰€æœ‰é‡è¦è³‡æ–™éƒ½æ›è¼‰åˆ°æœ¬åœ°ç›®éŒ„

### ComfyUI å·¥ä½œæµ

ç³»çµ±ä½¿ç”¨å…©å€‹å·¥ä½œæµæ¨¡æ¿ï¼š

1. **wan2.2_i2v_14b_single.json**ï¼šå–®åœ–æ¨¡å¼
   - ç¯€é» 6ï¼šæç¤ºè©è¼¸å…¥
   - ç¯€é» 52ï¼šåœ–ç‰‡è¼¸å…¥
   - ç¯€é» 75/76ï¼šå°ºå¯¸è¨­å®š
   - ç¯€é» 77ï¼šæ™‚é•·è¨­å®š

2. **wan2_2_i2v_14b_first_last.json**ï¼šé¦–å°¾å¹€æ¨¡å¼
   - ç¯€é» 22ï¼šæç¤ºè©è¼¸å…¥
   - ç¯€é» 12ï¼šé¦–å¹€åœ–ç‰‡
   - ç¯€é» 28ï¼šå°¾å¹€åœ–ç‰‡
   - ç¯€é» 33/34ï¼šå°ºå¯¸è¨­å®š
   - ç¯€é» 35ï¼šæ™‚é•·è¨­å®š

## ğŸ”Œ API æ–‡æª”

### ä¸»è¦ç«¯é»

#### ç”Ÿæˆå½±ç‰‡
```http
POST /api/generate
Content-Type: multipart/form-data

Parameters:
- prompt: æç¤ºè© (required)
- mode: ç”Ÿæˆæ¨¡å¼ "single" | "first_last" (required)
- width: å½±ç‰‡å¯¬åº¦ (required)
- height: å½±ç‰‡é«˜åº¦ (required)
- duration: å½±ç‰‡æ™‚é•· 81|129 (required)
- image: åœ–ç‰‡æ–‡ä»¶ (single mode)
- first_image: é¦–å¹€åœ–ç‰‡ (first_last mode)
- last_image: å°¾å¹€åœ–ç‰‡ (first_last mode)
```

#### ç²å–ä»»å‹™ç‹€æ…‹
```http
GET /api/task/{task_id}

Response:
{
  "task_id": "uuid",
  "status": "pending|processing|completed|failed",
  "prompt": "æç¤ºè©",
  "output_filename": "ç”Ÿæˆçš„å½±ç‰‡æª”å",
  "created_at": "å»ºç«‹æ™‚é–“",
  "completed_at": "å®Œæˆæ™‚é–“"
}
```

#### ç²å–æ’éšŠç‹€æ…‹
```http
GET /api/queue

Response:
{
  "local_queue": {
    "pending": 0,
    "processing": 1
  },
  "comfyui_queue": {
    "queue_running": [],
    "queue_pending": []
  }
}
```

### WebSocket äº‹ä»¶

- `task_completed`ï¼šä»»å‹™å®Œæˆé€šçŸ¥
- `task_failed`ï¼šä»»å‹™å¤±æ•—é€šçŸ¥
- `queue_update`ï¼šæ’éšŠç‹€æ…‹æ›´æ–°

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. ComfyUI é€£æ¥å¤±æ•—
**ç—‡ç‹€**ï¼šé é¢é¡¯ç¤ºã€Œæ­£åœ¨æª¢æŸ¥ç³»çµ±é€£ç·š...ã€
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèª ComfyUI åœ¨ 8188 åŸ æ­£å¸¸é‹è¡Œ
- æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
- ç¢ºèª Docker ç¶²è·¯é…ç½®

#### 2. ä»»å‹™å¡åœ¨è™•ç†ä¸­
**ç—‡ç‹€**ï¼šä»»å‹™é•·æ™‚é–“é¡¯ç¤ºã€Œè™•ç†ä¸­ã€
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨æ¢å¾© API
curl -X POST http://localhost:5005/api/recover-stuck-tasks
```

#### 3. å½±ç‰‡ç”Ÿæˆå¤±æ•—
**ç—‡ç‹€**ï¼šä»»å‹™ç‹€æ…‹è®Šç‚ºã€Œå¤±æ•—ã€
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥ ComfyUI æ—¥èªŒ
- ç¢ºèªå·¥ä½œæµæ¨¡æ¿æ­£ç¢º
- æª¢æŸ¥åœ–ç‰‡æ ¼å¼å’Œå¤§å°

#### 4. å®¹å™¨å•Ÿå‹•å¤±æ•—
**ç—‡ç‹€**ï¼š`docker-compose up` å¤±æ•—
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æª¢æŸ¥æ—¥èªŒ
docker-compose logs

# é‡æ–°æ§‹å»º
docker-compose build --no-cache
docker-compose up -d
```

### æ—¥èªŒæŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
docker-compose logs -f comfyui-api

# æŸ¥çœ‹ç‰¹å®šæ™‚é–“çš„æ—¥èªŒ
docker-compose logs --since="1h" comfyui-api
```

### æ€§èƒ½å„ªåŒ–

1. **è¨˜æ†¶é«”ä½¿ç”¨**ï¼šå»ºè­°è‡³å°‘ 12GB å¯ç”¨è¨˜æ†¶é«”
2. **ç£ç¢Ÿç©ºé–“**ï¼šå®šæœŸæ¸…ç†èˆŠçš„å½±ç‰‡æ–‡ä»¶
3. **ä¸¦ç™¼è™•ç†**ï¼šç³»çµ±è¨­è¨ˆç‚ºå–®ä»»å‹™è™•ç†ï¼Œé¿å…è³‡æºç«¶çˆ­

## ğŸ”„ æ›´æ–°æ—¥èªŒ

### v1.0.0
- âœ¨ æ–°å¢é›™æ¨¡å¼å½±ç‰‡ç”Ÿæˆï¼ˆå–®åœ– + é¦–å°¾å¹€ï¼‰
- ğŸ¨ å®Œæ•´çš„éŸ¿æ‡‰å¼ Web ç•Œé¢
- ğŸ“Š ä»»å‹™æ’éšŠå’Œç‹€æ…‹ç®¡ç†
- ğŸ”„ WebSocket å³æ™‚é€šçŸ¥
- ğŸ“š æ­·å²è¨˜éŒ„å’Œæœå°‹åŠŸèƒ½
- ğŸ³ Docker å®¹å™¨åŒ–éƒ¨ç½²
- ğŸ–¼ï¸ è‡ªå‹•ç¸®åœ–ç”Ÿæˆ
- ğŸ”Œ ComfyUI API æ•´åˆ

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚

---

<div align="center">
Made with â¤ï¸ by Create Intelligens Inc.
</div>
